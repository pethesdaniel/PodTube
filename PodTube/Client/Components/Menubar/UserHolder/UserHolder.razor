@using PodTube.Client.Components.Users.UserDisplay
@using PodTube.Client.Services;
@using PodTube.Shared.Models.DTO;
@inject HttpClient httpClient;
@inject NavigationManager Navigator;
@inject LoginService LoginService;

@if(LoginService.IsLoggedIn) {
    <MudButton Variant="Variant.Text" Color="Color.Inherit" OnClick="OnLogin">Login</MudButton>
} else {
    <MudStack Row>
        <UserDisplay User="User"></UserDisplay>
        <MudIconButton Color="Color.Inherit" Icon="@Icons.Material.Filled.Logout" OnClick="OnLogout" aria-label="logout"></MudIconButton>
    </MudStack>
}


@code {
    [Parameter] public UserDto? User { get; set; } = null;

    protected override async Task OnInitializedAsync() {
        var client = new UserApiClient(Navigator.BaseUri, httpClient);
        if (LoginService.IsLoggedIn) {
            User = await client.GetUserSelfAsync();
        }

        await base.OnInitializedAsync();
    }

    private void OnLogin() {
        Navigator.NavigateTo("/login");
    }

    private void OnLogout() {
        Navigator.NavigateTo("/logout");
    }
}
